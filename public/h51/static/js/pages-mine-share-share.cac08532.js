(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-mine-share-share"],{"11f6":function(e,t,n){var a=n("24fb");t=a(!1),t.push([e.i,'@charset "UTF-8";\r\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\r\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\r\n/* 项目的基本配置 */\r\n/* 基础 */\r\n/* 行为相关颜色 */\r\n/* 行为悬停颜色 */\r\n/* 行为背景颜色 */\r\n/* 渐变色 */\r\n/* 按钮长度 */\r\n/* 距离  */\r\n/* 字体 */\r\n/* 颜色变量 */\r\n/* 行为相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */.share .canvas-main[data-v-ec838418]{margin:0 auto}.share .canvas-main .canvas-content[data-v-ec838418]{margin:0 auto}.share .tabbar[data-v-ec838418]{width:%?99999?%}.share .tabbar .tabbar-content[data-v-ec838418]{width:%?690?%;white-space:nowrap}.share .tabbar .tabbar-item[data-v-ec838418]{display:inline-block;overflow:hidden;width:%?160?%;height:%?160?%;margin-right:%?30?%;position:relative;z-index:100}.share .tabbar .tabbar-item .check[data-v-ec838418]{position:absolute;top:0;right:0;z-index:100}',""]),e.exports=t},"1c5a":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return a}));var a={cThumb:n("6e29").default,cButton:n("1339").default},r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{staticClass:"share"},[n("v-uni-view",{staticClass:"tabbar m30"},[n("v-uni-scroll-view",{staticClass:"tabbar-content",attrs:{"scroll-x":!0}},e._l(e.bgList,(function(t,a){return n("v-uni-view",{key:a,staticClass:"tabbar-item",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.changeBg(a)}}},[n("v-uni-view",{staticClass:"check"},[n("c-thumb",{attrs:{src:"/static/icon/"+(a==e.current?"check-active":"check")+".png",size:"27"}})],1),n("c-thumb",{attrs:{src:e._f("jointUrl")(t.pic),size:"160",equal:""}})],1)})),1)],1),n("v-uni-view",{staticClass:"canvas-main"},[n("v-uni-canvas",{staticClass:"canvas-content",style:{width:e.canvasW+"px",height:e.canvasH+"px"},attrs:{"canvas-id":"canvas-content"}})],1),n("v-uni-view",{staticClass:"m30"},[n("c-button",{attrs:{type:"default-gradient",round:""},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.saveFile.apply(void 0,arguments)}}},[e._v("保存图片")])],1)],1)},i=[]},5125:function(e,t,n){"use strict";n.r(t);var a=n("1c5a"),r=n("d2e1");for(var i in r)"default"!==i&&function(e){n.d(t,e,(function(){return r[e]}))}(i);n("b3b0");var c,s=n("f0c5"),o=Object(s["a"])(r["default"],a["b"],a["c"],!1,null,"ec838418",null,!1,a["a"],c);t["default"]=o.exports},9299:function(e,t,n){var a=n("11f6");"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var r=n("4f06").default;r("04080396",a,!0,{sourceMap:!1,shadowMode:!1})},"9bd0":function(e,t,n){"use strict";(function(e){var a=n("4ea4");n("a9e3"),n("d3b7"),n("ac1f"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("96cf");var r=a(n("1da1")),i=a(n("5530")),c=n("2f62"),s=a(n("1cbb")),o={name:"share",computed:(0,i.default)({},(0,c.mapState)(["SYSTEM_INFO"])),data:function(){return{current:0,image:"",codeContent:"",ctx:null,canvasInfo:{},canvasW:0,canvasH:0,info:{},bgList:[]}},methods:{changeBg:function(e){var t=this;return(0,r.default)(regeneratorRuntime.mark((function n(){var a,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.current=e,a=t.$config.baseUrl+t.bgList[t.current].pic,n.next=4,t.saveFileToLocation(a);case 4:r=n.sent,t.drawShareContent(r);case 6:case"end":return n.stop()}}),n)})))()},makeCode:function(){var e=this;return(0,r.default)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,s.default.make({canvasId:"qrcode",componentInstance:e,text:e.codeContent,size:354,margin:10,backgroundColor:"#ffffff",foregroundColor:"#000000",fileType:"jpg",errorCorrectLevel:s.default.errorCorrectLevel.H});case 2:n=t.sent,e.image=n;case 4:case"end":return t.stop()}}),t)})))()},drawShareContent:function(e){var t=this;return(0,r.default)(regeneratorRuntime.mark((function n(){var a,r,i,c,s,o,u,l,f,v;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.$until.toast("生成中,请稍后"),a=uni.createCanvasContext("canvas-content"),r=t.canvasInfo.width,i=t.canvasInfo.height,a.setFillStyle("#1e1f2c"),a.fillRect(0,0,r,i),a.save(),c=.75*i,a.drawImage(e,0,0,r,c),s=t.info,o=s.avatar,o){n.next=12;break}return n.abrupt("return",t.$link.timeOutGoBack("请上传头像"));case 12:return o=t.$config.baseUrl+o,n.next=15,t.saveFileToLocation(o);case 15:return u=n.sent,l=50,a.drawImage(u,10,c+50,l,l),a.setFontSize(14),a.setFillStyle("white"),a.fillText(s.nick_name,l+20,c+65),a.fillText("邀请码:".concat(s.invite_code),l+20,c+90),f=t.$config.baseUrl+s.invite_qr_cede,n.next=25,t.saveFileToLocation(f);case 25:v=n.sent,a.drawImage(v,r-120,c+20,100,100),a.draw();case 28:case"end":return n.stop()}}),n)})))()},saveFileToLocation:function(e){var t=this;return new Promise((function(n){if(!e)return"";uni.downloadFile({url:e,success:function(e){200===e.statusCode?n(e.tempFilePath):t.$until.toast("下载失败")},fail:function(e){t.$until.toast("下载失败")}})}))},promotionCode:function(){var e=this;return(0,r.default)(regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$fetch.post("promotionCode",{});case 2:n=t.sent,a=n.data,n.msg,n.err,n.code,e.info=a,e,e.$nextTick((function(){}));case 10:case"end":return t.stop()}}),t)})))()},saveFile:function(){var t=this;uni.canvasToTempFilePath({canvasId:"canvas-content",fileType:"jpg",success:function(n){e("log",n," at pages/mine/share/share.vue:155"),t.$until.toast("请在APP上保存")}})},shareImg:function(){var e=this;return(0,r.default)(regeneratorRuntime.mark((function t(){var n,a,r,i,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$fetch.post("userQrcode",{});case 2:return n=t.sent,a=n.data,n.msg,n.err,r=a.spread_image,e.info=a.user,e.info.invite_qr_cede=a.invite_code,e.bgList=r,i=e.$config.baseUrl+e.bgList[e.current].pic,t.next=13,e.saveFileToLocation(i);case 13:c=t.sent,e.drawShareContent(c);case 15:case"end":return t.stop()}}),t)})))()}},onShow:function(){this.canvasW=.9*Number(this.SYSTEM_INFO.screenWidth),this.canvasH=.8*Number(this.SYSTEM_INFO.screenHeight)},onLoad:function(){var e=this,t=uni.createCanvasContext("canvas-content");this.ctx=t,this.$nextTick((function(){var t=uni.createSelectorQuery().select(".canvas-content");t.boundingClientRect(function(){var t=(0,r.default)(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.canvasInfo=n,e.shareImg();case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).exec()}))}};t.default=o}).call(this,n("0de9")["log"])},b3b0:function(e,t,n){"use strict";var a=n("9299"),r=n.n(a);r.a},d2e1:function(e,t,n){"use strict";n.r(t);var a=n("9bd0"),r=n.n(a);for(var i in a)"default"!==i&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t["default"]=r.a}}]);