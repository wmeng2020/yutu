{extend name="layout/main" /}

{block name="header"}

{/block}

{block name="content"}
<script src="__PUBLIC__/admin/js/laydate/laydate.js"></script>
<section class="panel" >

    <header class="panel-heading">
        <h4>任务列表</h4>
    </header>
    <div class="panel-body" style="padding-bottom: 50px">
        <form class="form-horizontal" action="{:url('taskList')}" >
            <div class="form-group">
                <div class="col-xs-1">
                    <select name="sort_id" class="form-control">
                        <option value="0">全部任务分类</option>
                        {foreach $allSort as $key=>$item}
                        <option {if $Request.get.sort_id == $key}selected{/if} value="{$key}">{$item}</option>
                        {/foreach}
                    </select>
                </div>
                <div class="col-xs-1">
                    <select name="need_type_id" class="form-control">
                        <option value="0">全部需求分类</option>
                        {foreach $allNeedType as $key=>$item}
                        <option {if $Request.get.need_type_id == $key}selected{/if} value="{$key}">{$item}</option>
                        {/foreach}
                    </select>
                </div>
                <!--<div class="col-xs-1 no-pd-r">-->
                    <!--<select name="type" id="type" class="form-control">-->
                        <!--<option {if $Request.get.type == 'type_name'} selected {/if} value="type_name">需求分类名称</option>-->
                    <!--</select>-->
                <!--</div>-->
                <!--<div class="col-xs-3 no-pd-l">-->
                    <!--<input type="text" value="{$Request.get.keyword}" name="keyword" id="keyword" class="form-control" placeholder="请输入关键词搜索">-->
                <!--</div>-->
                <div class="col-xs-2 no-pd-2">
                    <input type="text" value="{$Request.get.startTime}" name="startTime" id="startTime" class="form-control" placeholder="请输入开始时间">
                </div>
                <div class="col-xs-2 no-pd-2">
                    <input type="text" value="{$Request.get.endTime}" name="endTime" id="endTime" class="form-control" placeholder="请输入结束时间">
                </div>
                <button type="submit" class="btn btn-color">搜索</button>
                <a type="button" href="{:url('createTask')}" class="btn btn-info">添加任务</a>
            </div>
        </form>
        <table class="table table-bordered table-striped no-margin" >
            <thead>
                <tr>
                    <th class="text-center">ID</th>
                    <th class="text-center">任务分类名称</th>
                    <th class="text-center">需求分类名称</th>
                    <th class="text-center">任务链接</th>
                    <th class="text-center">需求方</th>
                    <th class="text-center">任务总数量</th>
                    <th class="text-center">任务价格</th>
                    <th class="text-center">状态</th>
                    <th class="text-center">创建时间</th>
                    <th class="text-center">操作</th>
                </tr>
            </thead>
            <tbody >
            {if $list}
                {foreach $list as $order}
                    <tr>
                        <td class="text-center">{$order->id}</td>
                        <td class="text-center">
                            {$order->getSort($order->sort_id)}
                        </td>
                        <td class="text-center">
                            {$order->getNeedType($order->need_type_id)}
                        </td>
                        <td class="text-center">
                            {$order->task_url}
                        </td>
                        <td class="text-center">
                            {$order->demand_side}
                        </td>
                        <td class="text-center">
                            {$order->task_num}
                        </td>
                        <td class="text-center">
                            {$order->task_price}
                        </td>
                        <td class="text-center">
                            {$order->getStatus($order->status)}
                        </td>
                        <td class="text-center">
                            {$order->create_time}
                        </td>
                        <td class="text-center">
                            <a href="{:url('createTask',['id'=>$order->id])}" class="btn btn-xs btn-info">修改</a>
                            <a data-url="{:url('deleteTask',['id'=>$order->id])}" onclick="main.ajaxDelete(this)" data-msg="确定要删除此任务吗？" class="btn btn-xs btn-danger">删除</a>
                        </td>
                    </tr>
                {/foreach}
            {else /}
                <tr class="text-center">
                    <td colspan="8">暂无数据</td>
                </tr>
            {/if}
            </tbody>
        </table>
        <div class="page">
            {:htmlspecialchars_decode($list->render())}
        </div>
    </div>
</section>
<script>
    laydate.render({
        elem: '#startTime',
        type: 'datetime'
    });
    laydate.render({
        elem: '#endTime',
        type: 'datetime'
    });
    $(function(){
        $(".image_click").zoomify();
    });
</script>

{/block}
{block name="footer"}
<form action="{:url('admin/Finance/exportFundLog')}" id="exportForm">
    <input type="hidden" name="keyword" id="e_keyword">
    <input type="hidden" name="type" id="e_type">
    <input type="hidden" name="startTime" id="e_startTime">
    <input type="hidden" name="endTime" id="e_endTime">
    <input type="hidden" name="page" value="{$Request.get.page}">
</form>
<script>
    //导出奖金记录
    $("#export").click(function(){
        var keyword = $("#keyword").val();
        var type = $("#type").val();
        var startTime = $("#startTime").val();
        var endTime = $("#endTime").val();
        var page = $("#page").val();
        $('#e_keyword').val(keyword);
        $('#e_type').val(type);
        $('#e_startTime').val(startTime);
        $('#e_endTime').val(endTime);
        $('#e_page').val(page);
        $("#exportForm").submit();
    })

</script>
{/block}
